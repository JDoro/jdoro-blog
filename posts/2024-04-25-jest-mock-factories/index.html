<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Jest Mock Factories</title><link rel=stylesheet href=jdoro-blog/css/main.css></head><body class="bg-gray-50 text-gray-900 min-h-screen flex flex-col dark:bg-gray-900 dark:text-gray-100"><header class="bg-white shadow mb-8 dark:bg-gray-800 dark:shadow-lg"><div class="container mx-auto px-4 py-6 flex items-center justify-between"><a href=/jdoro-blog/ class="text-3xl font-bold text-blue-600 hover:text-blue-800 transition
dark:text-blue-400
dark:hover:text-blue-200">JDORO.println</a>
<button id=dark-toggle class="ml-4 px-3 py-1 rounded bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-100 focus:outline-none transition">
<span id=dark-toggle-text>üåô Dark</span></button></div></header><main class="flex-1 container mx-auto px-4 py-8 bg-white rounded-lg shadow-md dark:bg-gray-800 dark:shadow-lg"><div class="max-w-2xl mx-auto py-8 px-4"><article class="prose prose-slate dark:prose-invert"><h1 class="text-3xl font-bold mb-4 dark:text-gray-100">Jest Mock Factories</h1><div class="flex items-center text-gray-500 text-sm space-x-4 mb-8 dark:text-gray-400"><span>Apr 25, 2024</span></div><p>One of the best features of the testing framework Jest is its built-in support
for mocking imports. There is a full suite of helper functions and utilities that
make it very easy to completely mock an imported file with very little effort.</p><p>Jest accomplishes this by rebuilding an entire registry of every module in the
dependency tree of everything you import into the test file. This happens once
per test suite/file. This can be pretty expensive and slow if you have a lot of
test suites or files with a lot of imports.</p><p>This module registry is being built for a Jest test suite. Jest can swap in a
mocked representation of that module. The most common way to do this is
with a simple line like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>jest</span>.<span style=color:#a6e22e>mock</span>(<span style=color:#e6db74>&#39;module&#39;</span>);
</span></span></code></pre></div><p>This automatically mocks this module anywhere it may be imported in the
dependency tree. Meaning it replaces every function exported from it with a
<code>jest.fn()</code>.</p><p>While this is great it doesn‚Äôt actually help our slowness. We still need to build
the whole module with all of its dependencies in order to identify the exported
interface for the module. If we still have to add all the child dependencies of
that file to the module registry then we haven‚Äôt saved ourselves anything yet.</p><p>The way to truly mock this module and prevent us from diving into it is to
provide a factory function like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>jest</span>.<span style=color:#a6e22e>mock</span>(<span style=color:#e6db74>&#39;module&#39;</span>, () =&gt; ({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>foo</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>jest</span>.<span style=color:#a6e22e>fn</span>(),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bar</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>jest</span>.<span style=color:#a6e22e>fn</span>()
</span></span><span style=display:flex><span>}));
</span></span></code></pre></div><p>Providing that factory function will completely replace the module with the
object you define here, and it won‚Äôt have to travel any deeper when building
the module registry.</p></article></div></main><footer class="mt-8 py-6 text-center text-gray-500 text-sm dark:text-gray-400">&copy; 2025 JDORO.println. Powered by <a href=https://gohugo.io/ class="text-blue-500 hover:underline dark:text-blue-300 dark:hover:text-blue-100">Hugo</a>.</footer><script>const body=document.documentElement,toggle=document.getElementById("dark-toggle"),toggleText=document.getElementById("dark-toggle-text");(localStorage.getItem("theme")==="dark"||!localStorage.getItem("theme")&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&(body.classList.add("dark"),toggleText&&(toggleText.textContent="‚òÄÔ∏è Light")),toggle.addEventListener("click",()=>{console.log("toggle"),body.classList.toggle("dark"),body.classList.contains("dark")?(localStorage.setItem("theme","dark"),toggleText.textContent="‚òÄÔ∏è Light"):(localStorage.setItem("theme","light"),toggleText.textContent="üåô Dark")})</script></body></html>